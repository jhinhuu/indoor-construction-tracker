<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工地记录管理系统</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- 引入SheetJS库用于Excel导出 -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <!-- 配置Tailwind自定义样式 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36CFC9',
                        accent: '#722ED1',
                        neutral: '#F2F3F5',
                        'neutral-dark': '#4E5969',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            }
            .transition-bg {
                transition: background-color 0.3s ease;
            }
            .empty-state {
                min-height: 200px;
            }
            .photo-preview {
                max-width: 150px;
                max-height: 150px;
                object-fit: cover;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800">
    <!-- 页面头部 -->
    <header class="bg-white shadow-sm sticky top-0 z-10">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-building-o text-primary text-2xl"></i>
                <h1 class="text-xl font-semibold text-gray-800">工地记录管理系统</h1>
            </div>
            <div class="export-buttons">
                <button class="export-btn excel bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md flex items-center transition-bg" id="exportExcel">
                    <i class="fas fa-file-excel mr-2"></i> 导出Excel
                </button>
            </div>
        </div>
    </header>

    <!-- 主要内容区 -->
    <main class="container mx-auto px-4 py-6">
        <!-- 项目信息卡片 -->
        <section class="bg-white rounded-lg p-6 mb-6 card-shadow">
            <h2 class="text-lg font-semibold mb-4 flex items-center">
                <i class="fa fa-info-circle text-primary mr-2"></i>项目基本信息
            </h2>
            <div class="project-info grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="info-item">
                    <label class="block text-sm text-gray-500 mb-1">项目名称</label>
                    <input type="text" class="value form-control w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50" value="现代简约风格住宅设计">
                </div>
                <div class="info-item">
                    <label class="block text-sm text-gray-500 mb-1">项目地址</label>
                    <input type="text" class="value form-control w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50" value="上海市浦东新区张杨路88号">
                </div>
                <div class="info-item">
                    <label class="block text-sm text-gray-500 mb-1">设计师</label>
                    <input type="text" class="value form-control w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50" value="李设计师">
                </div>
                <div class="info-item">
                    <label class="block text-sm text-gray-500 mb-1">当前阶段</label>
                    <input type="text" class="value form-control w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50" value="木工阶段">
                </div>
            </div>
        </section>

        <!-- 工地概况记录 -->
        <section class="bg-white rounded-lg p-6 mb-6 card-shadow">
            <h2 class="text-lg font-semibold mb-4 flex items-center">
                <i class="fa fa-bar-chart text-primary mr-2"></i>工地概况记录
            </h2>
            <div class="construction-overview grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="overview-item">
                    <label class="block text-sm text-gray-500 mb-1">记录日期</label>
                    <input type="date" class="overview-date form-control w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50" value="">
                </div>
                <div class="overview-item">
                    <label class="block text-sm text-gray-500 mb-1">天气状况</label>
                    <select class="overview-weather form-control w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50">
                        <option value="晴朗">晴朗</option>
                        <option value="多云">多云</option>
                        <option value="阴天">阴天</option>
                        <option value="小雨">小雨</option>
                        <option value="中雨">中雨</option>
                        <option value="大雨">大雨</option>
                        <option value="小雪">小雪</option>
                        <option value="中雪">中雪</option>
                        <option value="大雪">大雪</option>
                    </select>
                </div>
                <div class="overview-item">
                    <label class="block text-sm text-gray-500 mb-1">现场施工人员</label>
                    <input type="text" class="overview-workers form-control w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="例如：木工3人，电工2人">
                </div>
                <div class="overview-item md:col-span-2 lg:col-span-3">
                    <label class="block text-sm text-gray-500 mb-1">当日主要工作</label>
                    <textarea class="overview-work form-control w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50" rows="2" placeholder="描述当日主要施工内容"></textarea>
                </div>
                <div class="overview-item md:col-span-2 lg:col-span-3">
                    <label class="block text-sm text-gray-500 mb-1">现场问题记录</label>
                    <textarea class="overview-issues form-control w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50" rows="2" placeholder="记录现场出现的问题及处理情况"></textarea>
                </div>
                <div class="overview-item md:col-span-2 lg:col-span-3">
                    <label class="block text-sm text-gray-500 mb-1">现场照片记录</label>
                    <div class="flex items-center space-x-4">
                        <input type="file" id="photoUpload" accept="image/*" class="hidden" multiple>
                        <label for="photoUpload" class="bg-neutral hover:bg-gray-200 text-neutral-dark px-4 py-2 rounded-md cursor-pointer transition-bg flex items-center">
                            <i class="fa fa-upload mr-2"></i> 上传照片
                        </label>
                        <div id="photoPreviewContainer" class="flex flex-wrap gap-2 flex-1 overflow-x-auto pb-2">
                            <!-- 照片预览将显示在这里 -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-4 flex justify-end">
                <button id="addOverviewRecord" class="bg-secondary hover:bg-secondary/90 text-white px-4 py-2 rounded-md flex items-center transition-bg">
                    <i class="fa fa-plus-circle mr-2"></i> 添加概况记录
                </button>
            </div>
        </section>

        <!-- 工地变更记录 -->
        <section class="bg-white rounded-lg p-6 mb-6 card-shadow">
            <h2 class="text-lg font-semibold mb-4 flex items-center">
                <i class="fa fa-exchange text-primary mr-2"></i>工地变更记录
            </h2>
            <div class="construction-change grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="change-item">
                    <label class="block text-sm text-gray-500 mb-1">变更位置</label>
                    <input type="text" class="change-location form-control w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="例如：客厅墙面、主卧电路">
                </div>
                <div class="change-item">
                    <label class="block text-sm text-gray-500 mb-1">变更日期</label>
                    <input type="date" class="change-date form-control w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50" value="">
                </div>
                <div class="change-item">
                    <label class="block text-sm text-gray-500 mb-1">负责人姓名</label>
                    <input type="text" class="change-manager form-control w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="填写负责人姓名">
                </div>
                <div class="change-item md:col-span-2 lg:col-span-3">
                    <label class="block text-sm text-gray-500 mb-1">原方案描述</label>
                    <textarea class="change-original form-control w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50" rows="2" placeholder="详细描述变更前的方案内容"></textarea>
                </div>
                <div class="change-item md:col-span-2 lg:col-span-3">
                    <label class="block text-sm text-gray-500 mb-1">变更后方案</label>
                    <textarea class="change-updated form-control w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50" rows="2" placeholder="详细描述变更后的方案内容"></textarea>
                </div>
                <div class="change-item">
                    <label class="block text-sm text-gray-500 mb-1">变更原因</label>
                    <select class="change-reason form-control w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50">
                        <option value="客户要求">客户要求</option>
                        <option value="现场条件限制">现场条件限制</option>
                        <option value="施工问题">施工问题</option>
                        <option value="设计优化">设计优化</option>
                        <option value="材料变更">材料变更</option>
                    </select>
                </div>
                <div class="change-item">
                    <label class="block text-sm text-gray-500 mb-1">状态</label>
                    <select class="change-status form-control w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50">
                        <option value="待处理">待处理</option>
                        <option value="进行中">进行中</option>
                        <option value="已完成">已完成</option>
                        <option value="已确认">已确认</option>
                    </select>
                </div>
                <div class="change-item">
                    <label class="block text-sm text-gray-500 mb-1">影响的主材</label>
                    <input type="text" class="change-materials form-control w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="例如：瓷砖、电线、木板">
                </div>
                <div class="change-item md:col-span-2 lg:col-span-3">
                    <label class="block text-sm text-gray-500 mb-1">详细说明</label>
                    <textarea class="change-description form-control w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50" rows="3" placeholder="详细说明变更的原因、过程和影响等"></textarea>
                </div>
            </div>
            <div class="mt-4 flex justify-end">
                <button id="addChangeRecord" class="bg-accent hover:bg-accent/90 text-white px-4 py-2 rounded-md flex items-center transition-bg">
                    <i class="fa fa-plus-circle mr-2"></i> 添加变更记录
                </button>
            </div>
        </section>

        <!-- 现场记录区域 -->
        <section id="site" class="bg-white rounded-lg p-6 mb-6 card-shadow">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-semibold flex items-center" contenteditable="true" style="outline: transparent solid 1px;">
                    <i class="fa fa-list-alt text-primary mr-2"></i>现场记录
                </h2>
                <button id="saveRecord" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-md flex items-center transition-bg">
                    <i class="fa fa-save mr-2"></i> 保存现场记录
                </button>
            </div>
            
            <div class="record-list space-y-4" id="recordList">
                <!-- 记录项1 -->
                <div class="record-item border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-bg">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="record-title font-medium">墙面处理检查</h3>
                        <span class="record-date text-sm text-gray-500">2023-10-15 14:30</span>
                    </div>
                    <div class="record-content mb-3">
                        <p>今日检查墙面处理情况，整体符合要求，局部需要修补。</p>
                        <p>建议：明天安排工人进行修补工作。</p>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <span class="record-tag inline-block px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded">墙面</span>
                        <span class="record-tag inline-block px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded">需要修补</span>
                        <span class="record-tag status inline-block px-2 py-1 bg-green-100 text-green-800 text-xs rounded">已处理</span>
                    </div>
                </div>
                
                <!-- 记录项2 -->
                <div class="record-item border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-bg">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="record-title font-medium">水电管线铺设</h3>
                        <span class="record-date text-sm text-gray-500">2023-10-12 09:15</span>
                    </div>
                    <div class="record-content mb-3">
                        <p>水电管线铺设完成，已进行压力测试，结果合格。</p>
                        <p>下一步：准备进行墙面封闭工作。</p>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <span class="record-tag inline-block px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded">水电</span>
                        <span class="record-tag inline-block px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded">管道</span>
                        <span class="record-tag status inline-block px-2 py-1 bg-green-100 text-green-800 text-xs rounded">已完成</span>
                    </div>
                </div>
                
                <!-- 记录项3 -->
                <div class="record-item border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-bg">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="record-title font-medium">木工材料进场检查</h3>
                        <span class="record-date text-sm text-gray-500">2023-10-10 11:00</span>
                    </div>
                    <div class="record-content mb-3">
                        <p>木工材料今日进场，检查发现部分板材厚度不符合要求。</p>
                        <p>已联系供应商，要求明天更换合格材料。</p>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <span class="record-tag inline-block px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded">材料</span>
                        <span class="record-tag inline-block px-2 py-1 bg-red-100 text-red-800 text-xs rounded">不合格</span>
                        <span class="record-tag status inline-block px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded">处理中</span>
                    </div>
                </div>
            </div>
            
            <!-- 无记录提示，默认隐藏 -->
            <div id="emptyRecord" class="empty-state hidden flex flex-col items-center justify-center text-gray-400 py-10">
                <i class="fa fa-folder-open-o text-5xl mb-4"></i>
                <p class="text-lg">暂无记录</p>
                <p class="text-sm mt-2">请添加项目记录内容</p>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="bg-white border-t border-gray-200 py-4">
        <div class="container mx-auto px-4 text-center text-sm text-gray-500">
            <p>© 2023 工地记录管理系统 - 版权所有</p>
        </div>
    </footer>

    <!-- JavaScript代码 -->
    <script>
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 设置默认日期为今天
            const today = new Date().toISOString().split('T')[0];
            document.querySelector('.overview-date').value = today;
            document.querySelector('.change-date').value = today;
            
            // 检查记录是否为空并更新显示
            checkRecords();
            
            // 照片上传预览功能
            const photoUpload = document.getElementById('photoUpload');
            const photoPreviewContainer = document.getElementById('photoPreviewContainer');
            
            photoUpload.addEventListener('change', function(e) {
                const files = e.target.files;
                if (files) {
                    Array.from(files).forEach(file => {
                        if (file.type.startsWith('image/')) {
                            const reader = new FileReader();
                            
                            reader.onload = function(event) {
                                const preview = document.createElement('div');
                                preview.className = 'relative';
                                preview.innerHTML = `
                                    <img src="${event.target.result}" alt="现场照片" class="photo-preview rounded-md border border-gray-200">
                                    <button type="button" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs remove-photo">
                                        ×
                                    </button>
                                `;
                                photoPreviewContainer.appendChild(preview);
                                
                                // 添加删除照片功能
                                preview.querySelector('.remove-photo').addEventListener('click', function() {
                                    preview.remove();
                                });
                            };
                            
                            reader.readAsDataURL(file);
                        }
                    });
                }
            });
            
            // 添加概况记录功能
            document.getElementById('addOverviewRecord').addEventListener('click', function() {
                // 收集概况记录数据
                const date = document.querySelector('.overview-date').value;
                const weather = document.querySelector('.overview-weather').value;
                const workers = document.querySelector('.overview-workers').value;
                const workContent = document.querySelector('.overview-work').value;
                const issues = document.querySelector('.overview-issues').value;
                
                // 验证必要字段
                if (!date) {
                    alert('请选择记录日期');
                    return;
                }
                
                // 创建记录内容
                let content = `天气状况：${weather}\n`;
                content += `现场施工人员：${workers || '未记录'}\n`;
                content += `当日主要工作：${workContent || '未记录'}\n`;
                content += `现场问题记录：${issues || '无'}`;
                
                // 创建记录标签
                const tags = ['概况记录', weather];
                
                // 创建新记录项
                const recordElement = createRecordElement({
                    title: '工地概况记录',
                    date: `${date} ${new Date().getHours().toString().padStart(2, '0')}:${new Date().getMinutes().toString().padStart(2, '0')}`,
                    content: content,
                    tags: tags,
                    status: '已记录'
                });
                
                // 添加到记录列表
                document.getElementById('recordList').prepend(recordElement);
                
                // 保存记录
                document.getElementById('saveRecord').click();
                
                // 清空表单
                document.querySelector('.overview-workers').value = '';
                document.querySelector('.overview-work').value = '';
                document.querySelector('.overview-issues').value = '';
                photoPreviewContainer.innerHTML = '';
                photoUpload.value = '';
            });
            
            // 添加变更记录功能
            document.getElementById('addChangeRecord').addEventListener('click', function() {
                // 收集变更记录数据
                const location = document.querySelector('.change-location').value;
                const date = document.querySelector('.change-date').value;
                const manager = document.querySelector('.change-manager').value;
                const original = document.querySelector('.change-original').value;
                const updated = document.querySelector('.change-updated').value;
                const reason = document.querySelector('.change-reason').value;
                const status = document.querySelector('.change-status').value;
                const materials = document.querySelector('.change-materials').value;
                const description = document.querySelector('.change-description').value;
                
                // 验证必要字段
                if (!date || !location) {
                    alert('请填写变更日期和变更位置');
                    return;
                }
                
                // 创建记录内容
                let content = `变更位置：${location}\n`;
                content += `负责人：${manager || '未指定'}\n`;
                content += `原方案：${original || '未记录'}\n`;
                content += `变更后方案：${updated || '未记录'}\n`;
                content += `变更原因：${reason}\n`;
                content += `影响的主材：${materials || '无'}\n`;
                content += `详细说明：${description || '无'}`;
                
                // 创建记录标签
                const tags = ['变更记录', reason, status];
                
                // 创建新记录项
                const recordElement = createRecordElement({
                    title: `工地变更记录 - ${location}`,
                    date: `${date} ${new Date().getHours().toString().padStart(2, '0')}:${new Date().getMinutes().toString().padStart(2, '0')}`,
                    content: content,
                    tags: tags,
                    status: status
                });
                
                // 添加到记录列表
                document.getElementById('recordList').prepend(recordElement);
                
                // 保存记录
                document.getElementById('saveRecord').click();
                
                // 清空表单
                document.querySelector('.change-location').value = '';
                document.querySelector('.change-manager').value = '';
                document.querySelector('.change-original').value = '';
                document.querySelector('.change-updated').value = '';
                document.querySelector('.change-materials').value = '';
                document.querySelector('.change-description').value = '';
            });
            
            // 导出Excel功能
            document.getElementById('exportExcel').addEventListener('click', function() {
                // 收集项目基本信息
                const projectInfo = {
                    '项目名称': document.querySelector('.project-info .info-item:nth-child(1) input').value,
                    '项目地址': document.querySelector('.project-info .info-item:nth-child(2) input').value,
                    '设计师': document.querySelector('.project-info .info-item:nth-child(3) input').value,
                    '当前阶段': document.querySelector('.project-info .info-item:nth-child(4) input').value,
                    '导出日期': new Date().toLocaleString()
                };

                // 收集现场记录数据
                const siteRecords = [];
                document.querySelectorAll('#site .record-item').forEach(item => {
                    const title = item.querySelector('.record-title').textContent;
                    const date = item.querySelector('.record-date').textContent;
                    const content = Array.from(item.querySelectorAll('.record-content p'))
                        .map(p => p.textContent)
                        .join('; ');
                    const tags = Array.from(item.querySelectorAll('.record-tag:not(.status)'))
                        .map(tag => tag.textContent)
                        .join(', ');
                    const status = item.querySelector('.status')?.textContent || '';
                    
                    siteRecords.push({ title, date, content, tags, status });
                });

                // 创建工作簿
                const wb = XLSX.utils.book_new();
                
                // 创建项目信息工作表
                const projectSheet = XLSX.utils.json_to_sheet([projectInfo]);
                XLSX.utils.book_append_sheet(wb, projectSheet, '项目信息');
                
                // 创建现场记录工作表
                if (siteRecords.length > 0) {
                    const siteSheet = XLSX.utils.json_to_sheet(siteRecords);
                    XLSX.utils.book_append_sheet(wb, siteSheet, '现场记录');
                }

                // 导出文件
                XLSX.writeFile(wb, `${projectInfo['项目名称']}_工地记录.xlsx`);
                
                // 显示导出成功提示
                alert('Excel文件导出成功！');
            });

            // 保存现场记录功能
            document.getElementById('saveRecord').addEventListener('click', function() {
                // 收集现场记录数据
                const records = [];
                document.querySelectorAll('#site .record-item').forEach(item => {
                    const title = item.querySelector('.record-title').textContent;
                    const date = item.querySelector('.record-date').textContent;
                    const content = Array.from(item.querySelectorAll('.record-content p'))
                        .map(p => p.textContent)
                        .join('\n');
                    const tags = Array.from(item.querySelectorAll('.record-tag:not(.status)'))
                        .map(tag => tag.textContent);
                    const status = item.querySelector('.status')?.textContent || '';
                    
                    records.push({ title, date, content, tags, status });
                });

                // 保存到本地存储
                localStorage.setItem('constructionSiteRecords', JSON.stringify(records));
                
                // 保存项目基本信息
                const projectInfo = {
                    name: document.querySelector('.project-info .info-item:nth-child(1) input').value,
                    address: document.querySelector('.project-info .info-item:nth-child(2) input').value,
                    designer: document.querySelector('.project-info .info-item:nth-child(3) input').value,
                    stage: document.querySelector('.project-info .info-item:nth-child(4) input').value
                };
                localStorage.setItem('constructionProjectInfo', JSON.stringify(projectInfo));
                
                // 显示保存成功提示
                const saveBtn = this;
                const originalText = saveBtn.innerHTML;
                saveBtn.innerHTML = '<i class="fa fa-check mr-2"></i> 保存成功';
                saveBtn.classList.remove('bg-primary');
                saveBtn.classList.add('bg-green-500');
                
                setTimeout(() => {
                    saveBtn.innerHTML = originalText;
                    saveBtn.classList.remove('bg-green-500');
                    saveBtn.classList.add('bg-primary');
                }, 2000);
            });

            // 尝试从本地存储加载数据
            loadSavedData();
            
            // 使页面内容可编辑
            makeContentEditable();
            
            // 监听内容变化，检查记录是否为空
            const observer = new MutationObserver(function(mutations) {
                checkRecords();
            });
            
            observer.observe(document.getElementById('recordList'), {
                childList: true,
                subtree: true
            });
        });

        // 从本地存储加载数据
        function loadSavedData() {
            const savedRecords = localStorage.getItem('constructionSiteRecords');
            const savedProjectInfo = localStorage.getItem('constructionProjectInfo');
            
            if (savedProjectInfo) {
                const projectInfo = JSON.parse(savedProjectInfo);
                document.querySelector('.project-info .info-item:nth-child(1) input').value = projectInfo.name || '';
                document.querySelector('.project-info .info-item:nth-child(2) input').value = projectInfo.address || '';
                document.querySelector('.project-info .info-item:nth-child(3) input').value = projectInfo.designer || '';
                document.querySelector('.project-info .info-item:nth-child(4) input').value = projectInfo.stage || '';
            }
            
            if (savedRecords) {
                const records = JSON.parse(savedRecords);
                if (records.length > 0) {
                    // 清空现有记录
                    document.getElementById('recordList').innerHTML = '';
                    
                    // 添加保存的记录
                    records.forEach(record => {
                        const recordElement = createRecordElement(record);
                        document.getElementById('recordList').appendChild(recordElement);
                    });
                }
            }
        }

        // 创建记录元素
        function createRecordElement(record) {
            const div = document.createElement('div');
            div.className = 'record-item border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-bg';
            
            div.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <h3 class="record-title font-medium" contenteditable="true">${record.title}</h3>
                    <span class="record-date text-sm text-gray-500" contenteditable="true">${record.date}</span>
                </div>
                <div class="record-content mb-3">
                    ${record.content.split('\n').map(p => `<p contenteditable="true">${p}</p>`).join('')}
                </div>
                <div class="flex flex-wrap gap-2">
                    ${record.tags.map(tag => `<span class="record-tag inline-block px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded" contenteditable="true">${tag}</span>`).join('')}
                    <span class="record-tag status inline-block px-2 py-1 bg-green-100 text-green-800 text-xs rounded" contenteditable="true">${record.status}</span>
                </div>
            `;
            
            return div;
        }

        // 检查记录是否为空并更新显示
        function checkRecords() {
            const recordList = document.getElementById('recordList');
            const emptyRecord = document.getElementById('emptyRecord');
            const records = recordList.querySelectorAll('.record-item');
            
            // 如果没有记录，显示空状态提示，否则隐藏
            if (records.length === 0) {
                recordList.classList.add('hidden');
                emptyRecord.classList.remove('hidden');
            } else {
                recordList.classList.remove('hidden');
                emptyRecord.classList.add('hidden');
            }
        }

        // 使页面内容可编辑的函数
        function makeContentEditable() {
            // 将所有文本内容区域设置为可编辑
            document.querySelectorAll('p, span, div, h1, h2, h3, label').forEach(element => {
                // 排除按钮和不需要编辑的特定元素
                if (!element.closest('.btn, .export-btn, .tab, .status, .remove-photo')) {
                    element.setAttribute('contenteditable', 'true');
                    // 添加视觉提示
                    element.style.outline = '1px solid transparent';
                    element.addEventListener('focus', function() {
                        this.style.outline = '1px dashed #165DFF';
                    });
                    element.addEventListener('blur', function() {
                        this.style.outline = '1px solid transparent';
                    });
                }
            });

            // 确保所有表单元素保持可编辑状态
            document.querySelectorAll('input, textarea, select').forEach(input => {
                input.removeAttribute('readonly');
                input.removeAttribute('disabled');
            });
        }
    </script>
</body>
</html>
    
